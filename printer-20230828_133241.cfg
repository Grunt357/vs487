

[include btt36v11.cfg]
#[include mainsail.cfg]
#[include Klicky/*.cfg]
[include software/sensorless.cfg]
[include macros.cfg]
[include config_backup.cfg]
[include software/Adaptive_Purge.cfg]
[include software/Adaptive_Mesh.cfg]
[include software/WLED_config.cfg]
[include trad_rack.cfg]
[include trad_rack_optional.cfg]
[exclude_object]

###########################
### HARDWARE COMPONENTS ###
###########################
[include hardware/fans.cfg]
[include hardware/XY.cfg]
[include hardware/Z.cfg]
#[include hardware/probe.cfg]
[include hardware/temperature_sensors.cfg]
#[include hardware/stealthburner_leds.cfg]
#[include hardware/led_effects.cfg]

[mcu]

canbus_uuid: 6cb991e48d03

[printer]
kinematics: corexz
max_velocity: 200
max_accel: 2500
max_accel_to_decel: 1250
max_z_velocity: 50
max_z_accel: 1500
square_corner_velocity: 4.0

[save_variables]
filename: ~/variables.cfg
#   Required - provide a filename that would be used to save the
#   variables to disk e.g. ~/variables.cfg


[virtual_sdcard]
path: /home/biqu/printer_data/gcodes #~/gcode_files

[display_status]

[extruder]
step_pin: can0:EXT_STEP
dir_pin: !can0:EXT_DIR
enable_pin: !can0:EXT_EN
microsteps: 32
rotation_distance: 22.448 #21.388
gear_ratio: 50:10 #50:8 #for sherpa mini 8t motor
full_steps_per_rotation: 200 #1.8deg Motor
max_extrude_only_distance: 1400.0
max_extrude_only_accel: 50
nozzle_diameter: 0.400
filament_diameter: 1.750
heater_pin: can0:HE0
sensor_type: ATC Semitec 104GT-2 
pullup_resistor: 2200             
sensor_pin: can0:TH0
#control: pid
#pid_Kp: 21.527
#pid_Ki: 1.063
#pid_Kd: 108.982
min_temp: 0 
max_temp: 270
pressure_advance: 0.025                                              
pressure_advance_smooth_time: 0.040

[tmc2209 extruder]
uart_pin: can0:EXT_UART
run_current: 0.5 #0.650
stealthchop_threshold: 999999

[heater_bed]
heater_pin: PA5
sensor_type: Generic 3950
sensor_pin: PA0
#control: pid
#pid_Kp: 54.027
#pid_Ki: 0.770
#pid_Kd: 948.182
min_temp: 0 
max_temp: 130

#######################
### PROBE & BEDMESH ###
#######################
[bed_mesh]
speed: 100 #60
horizontal_move_z: 7 #10
mesh_min: 2,2
mesh_max: 210,205
probe_count: 5,5
algorithm: bicubic
#relative_reference_index: 12
#fade_start: 1
#fade_end: 10
#fade_target: 0




[probe]
pin: ^can0:LIMIT_1
x_offset: 0.0
y_offset: 0.0
#z_offset: -0.5
speed: 15
samples: 3
sample_retract_dist: 2
lift_speed: 5.0
samples_result: median
samples_tolerance: 0.02
samples_tolerance_retries: 5

activate_gcode:
    {% set PROBE_TEMP = 150 %}
    {% set MAX_TEMP = PROBE_TEMP + 5 %}
    {% set ACTUAL_TEMP = printer.extruder.temperature %}
    {% set TARGET_TEMP = printer.extruder.target %}

    {% if TARGET_TEMP > PROBE_TEMP %}
        { action_respond_info('Extruder temperature target of %.1fC is too high, lowering to %.1fC' % (TARGET_TEMP, PROBE_TEMP)) }
        M109 S{ PROBE_TEMP }
    {% else %}
        # Temperature target is already low enough, but nozzle may still be too hot.
        {% if ACTUAL_TEMP > MAX_TEMP %}
            { action_respond_info('Extruder temperature %.1fC is still too high, waiting until below %.1fC' % (ACTUAL_TEMP, MAX_TEMP)) }
            TEMPERATURE_WAIT SENSOR=extruder MAXIMUM={ MAX_TEMP }
        {% endif %}
    {% endif %}
    
[settling_probe]
settling_sample: True
#   Globally enable the throw-away settling sample. Default is 'False'.
#   Setting this to 'True' will enable the throw-away sample for all
#   commands/operations that perform Z probing (QGL, Z tilt, Bed Mesh,
#   Screw Tilt, etc.)

[homing_override]
axes: xyz
gcode:
	{% set home_all = 'X' not in params and 'Y' not in params and 'Z' not in params %}

	{% if home_all or 'X' in params %}
		_HOME_X
        
	{% endif %}
	
	{% if home_all or 'Y' in params %}
		_HOME_Y
	{% endif %}
	
	{% if home_all or 'Z' in params %}
		G90
		G0 X110 Y110 F15000													#<-!-!-!- Set to the position of your Z endstop
		G28 Z
		G1 Z15
	{% endif %}

[z_tilt]
z_positions:
    10,7
    #10,320
    #305,7
    305,320
points:
    50,50
    50,195
    195,195
    195,50

[screws_tilt_adjust]
screw1: 25,190
screw1_name: rear left screw 
screw2: 195,190
screw2_name: rear right screw
screw3: 195,20
screw3_name: front right screw
screw4: 25,20
screw4_name: front left screw
horizontal_move_z: 10
speed: 50
screw_thread: CW-M4


[idle_timeout]
# only turn off heaters and motors if the printer is not paused
gcode:
    {% if not printer.pause_resume.is_paused %}
        TURN_OFF_HEATERS
        M84
    {% endif %}

[output_pin nozzle_light] 
pin: can0:RGBLED
#pwm: True 
value: 0.1 
#cycle_time: 0.001 
#hardware_pwm: True

# z-offsets -  Previous samples 6.298 #6.293 #6.288

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 68.268
#*# pid_ki = 2.346
#*# pid_kd = 496.650
#*#
#*# [extruder]
#*# control = pid
#*# pid_kp = 33.180
#*# pid_ki = 7.900
#*# pid_kd = 34.839
#*#
#*# [probe]
#*# z_offset = -1.500
